---
layout: spring-test-post
title: "DB Unit"
date: 2019-06-05
tags: [test,dbuit]
excerpt: ""
spring-test: true
comments: true
---


### Maven

~~~xml
<dependency>
    <groupId>org.dbunit</groupId>
    <artifactId>dbunit</artifactId>
    <version>2.6.0</version>
    <scope>test</scope>
</dependency>
~~~


먼저 데이터베이스 테이블을 나타내는 XML 파일을 만들어야합니다.  


#### user.xml

~~~xml
<?xml version="1.0" encoding="UTF-8"?>
<dataset>
    <USER userid='1' first_name='Vinod' last_name='Kashyap' />

    <USER userid='2' first_name='Dhwani' last_name='Kashyap' />

    <USER userid='3' first_name='Asmi' last_name='Kashyap' />
</dataset>
~~~

- table: USER  
- column: userid, first_name, last_name  

`user.xml` 파일 위치는 **루트 경로** 에 둡니다.  


~~~java
package junitdbunit;

import static org.hamcrest.CoreMatchers.is;
import static org.junit.Assert.assertThat;

import java.io.FileInputStream;

import org.dbunit.DBTestCase;
import org.dbunit.PropertiesBasedJdbcDatabaseTester;
import org.dbunit.dataset.IDataSet;
import org.dbunit.dataset.xml.FlatXmlDataSetBuilder;
import org.dbunit.operation.DatabaseOperation;
import org.junit.Test;

public class DbUnit extends DBTestCase {

		// database 연결 초기화
    public DbUnit(String name) {
        super(name);
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_DRIVER_CLASS, "com.mysql.jdbc.Driver");
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_CONNECTION_URL, "jdbc:mysql://localhost:3306/user");
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_USERNAME, "root");
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_PASSWORD, "");
    }

 		/*  
				XML 파일을 읽고 데이터베이스에 필수 항목을 작성합니다.
				여기에서는 IDataSet의 FlatXmlDataSet을 사용하고 있습니다.
		*/
    protected IDataSet getDataSet() throws Exception {
        return new FlatXmlDataSetBuilder().build(new FileInputStream("user.xml"));
    }

		// 테스트하기 전에 데이터베이스를 초기 위치로 설정합니다.
    protected DatabaseOperation getSetUpOperation() throws Exception {
        return DatabaseOperation.REFRESH;
    }

 		// 테스트 케이스 실행 후 모든 entry가 지워집니다.
    protected DatabaseOperation getTearDownOperation() throws Exception {
        return DatabaseOperation.NONE;
    }

    @Test
    public void testById() {

        int userId = 5;// get user id from database
        assertThat(1, is(userId));
    }
}
~~~
